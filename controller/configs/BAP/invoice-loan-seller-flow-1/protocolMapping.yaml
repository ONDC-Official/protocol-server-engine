protocol:
  search:
    mapping:
      - beckn_key: context.bap_id
        value: session.bap_id
      - beckn_key: context.bap_uri
        value: session.bap_uri
      - beckn_key: context.location.country.code
        value: session.country
      - beckn_key: context.location.city.code
        value: session.cityCode
      - beckn_key: context.transaction_id
        value: session.currentTransactionId
      - beckn_key: context.message_id
        value: messageId
      - beckn_key: context.timestamp
        value: timestamp
      - beckn_key: context.domain
        value: session.domain
      - beckn_key: context.version
        value: session.version
      - beckn_key: context.ttl
        value: session.ttl
      - beckn_key: context.action
        value: action

      - beckn_key: message.intent.category.descriptor.code
        value: session.loanCategaory

      - beckn_key: message.intent.payment.collected_by
        value: session.paymentCollectedBy
      - beckn_key: message.intent.payment.tags
        value: session.paymentTagsSearch
        compute: buildTags(session.paymentTagsSearch)

  search_1:
    mapping:
      - beckn_key: context.bap_id
        value: session.bap_id
      - beckn_key: context.bap_uri
        value: session.bap_uri
      - beckn_key: context.bpp_id
        value: session.bpp_id
      - beckn_key: context.bpp_uri
        value: session.bpp_uri
      - beckn_key: context.location.country.code
        value: session.country
      - beckn_key: context.location.city.code
        value: session.cityCode
      - beckn_key: context.transaction_id
        value: session.currentTransactionId
      - beckn_key: context.message_id
        value: messageId
      - beckn_key: context.timestamp
        value: timestamp
      - beckn_key: context.domain
        value: session.domain
      - beckn_key: context.version
        value: session.version
      - beckn_key: context.ttl
        value: session.ttl
      - beckn_key: context.action
        value: action

      - beckn_key: message.intent.category.descriptor.code
        value: session.loanCategaory
      - beckn_key: message.intent.provider.id
        value: data.providerId
      - beckn_key: message.intent.provider.items[0].id
        value: session.itemId
      - beckn_key: message.intent.provider.items[0].xinput.form.id
        value: session.formId
      - beckn_key: message.intent.provider.items[0].xinput.form_response.status
        value: successStatus
      - beckn_key: message.intent.provider.items[0].xinput.form_response.submission_id
        value: data.personalInfoSubmissionId

      - beckn_key: message.intent.payment.collected_by
        value: session.paymentCollectedBy
      - beckn_key: message.intent.payment.tags
        value: session.paymentTagsSearch
        compute: buildTags(session.paymentTagsSearch)

  search_2:
    mapping:
      - beckn_key: context.bap_id
        value: session.bap_id
      - beckn_key: context.bap_uri
        value: session.bap_uri
      - beckn_key: context.bpp_id
        value: session.bpp_id
      - beckn_key: context.bpp_uri
        value: session.bpp_uri
      - beckn_key: context.location.country.code
        value: session.country
      - beckn_key: context.location.city.code
        value: session.cityCode
      - beckn_key: context.transaction_id
        value: session.currentTransactionId
      - beckn_key: context.message_id
        value: messageId
      - beckn_key: context.timestamp
        value: timestamp
      - beckn_key: context.domain
        value: session.domain
      - beckn_key: context.version
        value: session.version
      - beckn_key: context.ttl
        value: session.ttl
      - beckn_key: context.action
        value: action

      - beckn_key: message.intent.category.descriptor.code
        value: session.loanCategaory
      - beckn_key: message.intent.provider.id
        value: data.providerId
      - beckn_key: message.intent.provider.items[0].id
        value: session.itemId
      - beckn_key: message.intent.provider.items[0].xinput.form.id
        value: session.formId
      - beckn_key: message.intent.provider.items[0].xinput.form_response.status
        value: "'APPROVED'"
      - beckn_key: message.intent.provider.items[0].xinput.form_response.submission_id
        value: data.personalInfoSubmissionId

      - beckn_key: message.intent.payment.collected_by
        value: session.paymentCollectedBy
      - beckn_key: message.intent.payment.tags
        value: session.paymentTagsSearch
        compute: buildTags(session.paymentTagsSearch)

  select:
    mapping:
      - beckn_key: context.bap_id
        value: session.bap_id
      - beckn_key: context.bap_uri
        value: session.bap_uri
      - beckn_key: context.bpp_id
        value: session.bpp_id
      - beckn_key: context.bpp_uri
        value: session.bpp_uri
      - beckn_key: context.location.country.code
        value: session.country
      - beckn_key: context.location.city.code
        value: session.cityCode
      - beckn_key: context.transaction_id
        value: session.currentTransactionId
      - beckn_key: context.message_id
        value: messageId
      - beckn_key: context.timestamp
        value: timestamp
      - beckn_key: context.domain
        value: session.domain
      - beckn_key: context.version
        value: session.version
      - beckn_key: context.ttl
        value: session.ttl
      - beckn_key: context.action
        value: action

      - beckn_key: message.order.provider.id
        value: session.providerId
      - beckn_key: message.order.items[0].id
        value: data.selectItemID
      - beckn_key: message.order.items[0].parent_item_id
        value: data.parentItemId

  select_1:
    mapping:
      - beckn_key: context.bap_id
        value: session.bap_id
      - beckn_key: context.bap_uri
        value: session.bap_uri
      - beckn_key: context.bpp_id
        value: session.bpp_id
      - beckn_key: context.bpp_uri
        value: session.bpp_uri
      - beckn_key: context.location.country.code
        value: session.country
      - beckn_key: context.location.city.code
        value: session.cityCode
      - beckn_key: context.transaction_id
        value: session.currentTransactionId
      - beckn_key: context.message_id
        value: messageId
      - beckn_key: context.timestamp
        value: timestamp
      - beckn_key: context.domain
        value: session.domain
      - beckn_key: context.version
        value: session.version
      - beckn_key: context.ttl
        value: session.ttl
      - beckn_key: context.action
        value: action

      - beckn_key: message.order.provider.id
        value: session.providerId
      - beckn_key: message.order.items[0].id
        value: session.selectItemID
      - beckn_key: message.order.items[0].parent_item_id
        value: session.parentItemId
      - beckn_key: message.order.items[0].xinput.form.id
        value: session.formIdAmountAdjustForm
      - beckn_key: message.order.items[0].xinput.form_response.status
        value: "'SUCCESS'"
      - beckn_key: message.order.items[0].xinput.form_response.submission_id
        value: data.adjustAmountSubmissionId

  init:
    mapping:
      - beckn_key: context.bap_id
        value: session.bap_id
      - beckn_key: context.bap_uri
        value: session.bap_uri
      - beckn_key: context.bpp_id
        value: session.bpp_id
      - beckn_key: context.bpp_uri
        value: session.bpp_uri
      - beckn_key: context.location.country.code
        value: session.country
      - beckn_key: context.location.city.code
        value: session.cityCode
      - beckn_key: context.transaction_id
        value: session.currentTransactionId
      - beckn_key: context.message_id
        value: messageId
      - beckn_key: context.timestamp
        value: timestamp
      - beckn_key: context.domain
        value: session.domain
      - beckn_key: context.version
        value: session.version
      - beckn_key: context.ttl
        value: session.ttl
      - beckn_key: context.action
        value: action

      - beckn_key: message.order.provider.id
        value: session.providerId
      - beckn_key: message.order.items[0].id
        value: session.selectItemID
      - beckn_key: message.order.items[0].parent_item_id
        value: session.parentItemId
      - beckn_key: message.order.items[0].xinput.form.id
        value: session.customerInfoFormId
      - beckn_key: message.order.items[0].xinput.form_response.status
        value: "'SUCCESS'"
      - beckn_key: message.order.items[0].xinput.form_response.submission_id
        value: data.customerInfoSubmissionId

      - beckn_key: message.order.payments[0].collected_by
        value: session.collectedBy
      - beckn_key: message.order.payments[0].status
        value: data.paymentStatus
      - beckn_key: message.order.payments[0].type
        value: data.paymentType
      - beckn_key: message.order.payments[0].params.bank_code
        value: session.bankCode
      - beckn_key: message.order.payments[0].params.bank_account_number
        value: session.bankAccountNumber
      - beckn_key: message.order.payments[0].params.virtual_payment_address
        value: session.virtualPaymentAddress
      - beckn_key: message.order.payments[0].tags
        value: data.paymentTagsInit
        compute: buildTags(data.paymentTagsInit)

  init_1:
    mapping:
      - beckn_key: context.bap_id
        value: session.bap_id
      - beckn_key: context.bap_uri
        value: session.bap_uri
      - beckn_key: context.bpp_id
        value: session.bpp_id
      - beckn_key: context.bpp_uri
        value: session.bpp_uri
      - beckn_key: context.location.country.code
        value: session.country
      - beckn_key: context.location.city.code
        value: session.cityCode
      - beckn_key: context.transaction_id
        value: session.currentTransactionId
      - beckn_key: context.message_id
        value: messageId
      - beckn_key: context.timestamp
        value: timestamp
      - beckn_key: context.domain
        value: session.domain
      - beckn_key: context.version
        value: session.version
      - beckn_key: context.ttl
        value: session.ttl
      - beckn_key: context.action
        value: action

      - beckn_key: message.order.provider.id
        value: session.providerId
      - beckn_key: message.order.items[0].id
        value: session.selectItemID
      - beckn_key: message.order.items[0].parent_item_id
        value: session.parentItemId
      - beckn_key: message.order.items[0].xinput.form.id
        value: session.kycFormId
      - beckn_key: message.order.items[0].xinput.form_response.status
        value: "'SUCCESS'"
      - beckn_key: message.order.items[0].xinput.form_response.submission_id
        value: data.kycSubmissionId

      - beckn_key: message.order.payments[0].id
        value: session.paymentID[0].id
      - beckn_key: message.order.payments[0].collected_by
        value: session.collectedBy
      - beckn_key: message.order.payments[0].status
        value: data.paymentStatusInit1
      - beckn_key: message.order.payments[0].type
        value: data.paymentType
      - beckn_key: message.order.payments[0].params.bank_code
        value: session.bankCode
      - beckn_key: message.order.payments[0].params.bank_account_number
        value: session.bankAccountNumber
      - beckn_key: message.order.payments[0].params.virtual_payment_address
        value: session.virtualPaymentAddress
      - beckn_key: message.order.payments[0].tags
        value: data.paymentTagsInit
        compute: buildTags(data.paymentTagsInit)

  init_2:
    mapping:
      - beckn_key: context.bap_id
        value: session.bap_id
      - beckn_key: context.bap_uri
        value: session.bap_uri
      - beckn_key: context.bpp_id
        value: session.bpp_id
      - beckn_key: context.bpp_uri
        value: session.bpp_uri
      - beckn_key: context.location.country.code
        value: session.country
      - beckn_key: context.location.city.code
        value: session.cityCode
      - beckn_key: context.transaction_id
        value: session.currentTransactionId
      - beckn_key: context.message_id
        value: messageId
      - beckn_key: context.timestamp
        value: timestamp
      - beckn_key: context.domain
        value: session.domain
      - beckn_key: context.version
        value: session.version
      - beckn_key: context.ttl
        value: session.ttl
      - beckn_key: context.action
        value: action

      - beckn_key: message.order.provider.id
        value: session.providerId
      - beckn_key: message.order.items[0].id
        value: session.selectItemID
      - beckn_key: message.order.items[0].parent_item_id
        value: session.parentItemId
      - beckn_key: message.order.items[0].xinput.form.id
        value: session.accointDetailsFormId
      - beckn_key: message.order.items[0].xinput.form_response.status
        value: "'SUCCESS'"
      - beckn_key: message.order.items[0].xinput.form_response.submission_id
        value: data.accointDetailsFormSubmissionId

      - beckn_key: message.order.payments[0].id
        value: session.paymentID[0].id
      - beckn_key: message.order.payments[0].status
        value: data.paymentStatusInit1
      - beckn_key: message.order.payments[0].collected_by
        value: session.collectedBy
      - beckn_key: message.order.payments[0].type
        value: data.paymentType
      - beckn_key: message.order.payments[0].params.bank_code
        value: session.bankCode
      - beckn_key: message.order.payments[0].params.bank_account_number
        value: session.bankAccountNumber
      - beckn_key: message.order.payments[0].params.virtual_payment_address
        value: session.virtualPaymentAddress
      - beckn_key: message.order.payments[0].tags
        value: data.paymentTagsInit
        compute: buildTags(data.paymentTagsInit)

  init_3:
    mapping:
      - beckn_key: context.bap_id
        value: session.bap_id
      - beckn_key: context.bap_uri
        value: session.bap_uri
      - beckn_key: context.bpp_id
        value: session.bpp_id
      - beckn_key: context.bpp_uri
        value: session.bpp_uri
      - beckn_key: context.location.country.code
        value: session.country
      - beckn_key: context.location.city.code
        value: session.cityCode
      - beckn_key: context.transaction_id
        value: session.currentTransactionId
      - beckn_key: context.message_id
        value: messageId
      - beckn_key: context.timestamp
        value: timestamp
      - beckn_key: context.domain
        value: session.domain
      - beckn_key: context.version
        value: session.version
      - beckn_key: context.ttl
        value: session.ttl
      - beckn_key: context.action
        value: action

      - beckn_key: message.order.provider.id
        value: session.providerId
      - beckn_key: message.order.items[0].id
        value: session.selectItemID
      - beckn_key: message.order.items[0].parent_item_id
        value: session.parentItemId
      - beckn_key: message.order.items[0].xinput.form.id
        value: session.eMandateDetailsFormId
      - beckn_key: message.order.items[0].xinput.form_response.status
        value: "'SUCCESS'"
      - beckn_key: message.order.items[0].xinput.form_response.submission_id
        value: data.eMandateDetailsSubmissionId

      - beckn_key: message.order.payments[0].id
        value: session.paymentID[0].id
      - beckn_key: message.order.payments[0].status
        value: data.paymentStatusInit1
      - beckn_key: message.order.payments[0].collected_by
        value: session.collectedBy
      - beckn_key: message.order.payments[0].type
        value: data.paymentType
      - beckn_key: message.order.payments[0].params.bank_code
        value: session.bankCode
      - beckn_key: message.order.payments[0].params.bank_account_number
        value: session.bankAccountNumber
      - beckn_key: message.order.payments[0].params.virtual_payment_address
        value: session.virtualPaymentAddress
      - beckn_key: message.order.payments[0].tags
        value: data.paymentTagsInit
        compute: buildTags(data.paymentTagsInit)

  confirm:
    mapping:
      - beckn_key: context.bap_id
        value: session.bap_id
      - beckn_key: context.bap_uri
        value: session.bap_uri
      - beckn_key: context.bpp_id
        value: session.bpp_id
      - beckn_key: context.bpp_uri
        value: session.bpp_uri
      - beckn_key: context.location.country.code
        value: session.country
      - beckn_key: context.location.city.code
        value: session.cityCode
      - beckn_key: context.transaction_id
        value: session.currentTransactionId
      - beckn_key: context.message_id
        value: messageId
      - beckn_key: context.timestamp
        value: timestamp
      - beckn_key: context.domain
        value: session.domain
      - beckn_key: context.version
        value: session.version
      - beckn_key: context.ttl
        value: session.ttl
      - beckn_key: context.action
        value: action

      - beckn_key: message.order.provider.id
        value: session.providerId
      - beckn_key: message.order.items[0].id
        value: session.selectItemID
      - beckn_key: message.order.items[0].parent_item_id
        value: session.parentItemId
      - beckn_key: message.order.items[0].xinput.form.id
        value: data.loanAgreementFormId
      - beckn_key: message.order.items[0].xinput.form_response.status
        value: "'SUCCESS'"
      - beckn_key: message.order.items[0].xinput.form_response.submission_id
        value: data.loanAgreementSubmissionId

      - beckn_key: message.order.payments[0].id
        value: session.paymentID[0].id
      - beckn_key: message.order.payments[0].collected_by
        value: session.collectedBy
      - beckn_key: message.order.payments[0].status
        value: data.paymentStatusConfirm
      - beckn_key: message.order.payments[0].type
        value: data.paymentTypeConfirm
      - beckn_key: message.order.payments[0].params.bank_code
        value: session.bankCode
      - beckn_key: message.order.payments[0].params.bank_account_number
        value: session.bankAccountNumber
      - beckn_key: message.order.payments[0].params.virtual_payment_address
        value: session.virtualPaymentAddress
      - beckn_key: message.order.payments[0].tags
        value: data.paymentTagsInit
        compute: buildTags(data.paymentTagsInit)

  status:
    mapping:
      - beckn_key: context.bap_id
        value: session.bap_id
      - beckn_key: context.bap_uri
        value: session.bap_uri
      - beckn_key: context.bpp_id
        value: session.bpp_id
      - beckn_key: context.bpp_uri
        value: session.bpp_uri
      - beckn_key: context.location.country.code
        value: session.country
      - beckn_key: context.location.city.code
        value: session.cityCode
      - beckn_key: context.transaction_id
        value: session.currentTransactionId
      - beckn_key: context.message_id
        value: messageId
      - beckn_key: context.timestamp
        value: timestamp
      - beckn_key: context.domain
        value: session.domain
      - beckn_key: context.version
        value: session.version
      - beckn_key: context.ttl
        value: session.ttl
      - beckn_key: context.action
        value: action

      - beckn_key: message.ref_id
        value: session.currentTransactionId

  update:
    mapping:
      - beckn_key: context.bap_id
        value: session.bap_id
      - beckn_key: context.bap_uri
        value: session.bap_uri
      - beckn_key: context.bpp_id
        value: session.bpp_id
      - beckn_key: context.bpp_uri
        value: session.bpp_uri
      - beckn_key: context.location.country.code
        value: session.country
      - beckn_key: context.location.city.code
        value: session.cityCode
      - beckn_key: context.transaction_id
        value: session.currentTransactionId
      - beckn_key: context.message_id
        value: messageId
      - beckn_key: context.timestamp
        value: timestamp
      - beckn_key: context.domain
        value: session.domain
      - beckn_key: context.version
        value: session.version
      - beckn_key: context.ttl
        value: session.ttl
      - beckn_key: context.action
        value: action

      - beckn_key: message.update_target
        value: fulfillmentText
      - beckn_key: message.order.id
        value: data.orderId
      - beckn_key: message.order.fulfillments[0].state.descriptor.code
        value: data.fulfillmentStatus

  on_search:
    sessionData:
      - business_key: "formId"
        extractionPath: "message.catalog.providers[].items[]{ id : xinput.form.id, itemId: id}"
      - business_key: "providerId"
        extractionPath: "message.catalog.providers[]{id: id}"
    mapping:
      - business_key: "bpp_id"
        extractionPath: context.bpp_id
      - business_key: "bpp_uri"
        extractionPath: context.bpp_uri
      - business_key: formData
        extractionPath: "message.catalog.providers[]{providerId: id}.items[]{formUrl : xinput.form.url, id : xinput.form.id, itemId: id}"
      - business_key: error
        extractionPath: error

  on_search_1:
    mapping:
      - business_key: error
        extractionPath: error

  on_search_2:
    mapping:
      - business_key: itemDetails
        extractionPath: "message.catalog.providers[].items[?(parent_item_id)]{itemID: id, parentItemId: parent_item_id}"
      - business_key: error
        extractionPath: error

  on_select:
    mapping:
      - business_key: formData
        extractionPath: "message.order.items[]{mimeType: xinput.form.mime_type, formUrl : xinput.form.url, id : xinput.form.id, itemId: id}"
      - business_key: error
        extractionPath: error

  on_select_1:
    mapping:
      - business_key: providerId
        extractionPath: "message.order.provider.id"
      - business_key: formData
        extractionPath: "message.order.items[]{mimeType: xinput.form.mime_type, formUrl : xinput.form.url, id : xinput.form.id, itemId: id}"
      - business_key: error
        extractionPath: error

  on_init:
    sessionData:
      - business_key: paymentID
        extractionPath: "message.order.payments[]{id: id}"
    mapping:
      - business_key: formData
        extractionPath: "message.order.items[]{mimeType: xinput.form.mime_type, formUrl : xinput.form.url, id : xinput.form.id, itemId: id}"
      - business_key: error
        extractionPath: error

  on_init_1:
    mapping:
      - business_key: formData
        extractionPath: "message.order.items[]{mimeType: xinput.form.mime_type, formUrl : xinput.form.url, id : xinput.form.id, itemId: id}"
      - business_key: error
        extractionPath: error

  on_init_2:
    mapping:
      - business_key: formData
        extractionPath: "message.order.items[]{mimeType: xinput.form.mime_type, formUrl : xinput.form.url, id : xinput.form.id, itemId: id}"
      - business_key: error
        extractionPath: error

  on_init_3:
    mapping:
      - business_key: formData
        extractionPath: "message.order.items[]{mimeType: xinput.form.mime_type, formUrl : xinput.form.url, id : xinput.form.id, itemId: id}"
      - business_key: error
        extractionPath: error

  on_confirm:
    sessionData:
      - business_key: orderId
        extractionPath: message.order.id
    mapping:
      - business_key: orderId
        extractionPath: message.order.id
      - business_key: error
        extractionPath: error

  on_status:
    mapping:
      - business_key: formData
        extractionPath: "message.order.items[]{id: xinput.form.id, status: xinput.form_response.status, submissionId:  xinput.form_response.submission_id}"
      - business_key: error
        extractionPath: error

  on_update:
    mapping:
      - business_key: error
        extractionPath: error
